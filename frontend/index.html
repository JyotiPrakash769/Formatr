<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FORMATR</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>FORMATR</h1>
            <div style="display: flex; gap: 10px; align-items: center;">
                <button id="theme-toggle">THEME</button>
                <div id="status">OFFLINE</div>
            </div>
        </header>

        <nav class="grid-nav">
            <button class="nav-btn active" onclick="showPanel('home')">HOME</button>
            <button class="nav-btn" onclick="showPanel('images')">IMAGES</button>
            <button class="nav-btn" onclick="showPanel('docs')">DOCS</button>
            <button class="nav-btn" onclick="showPanel('archive')">ARCHIVE</button>
            <button class="nav-btn" onclick="showPanel('data')">DATA</button>
            <button class="nav-btn" onclick="showPanel('dev')">DEV</button>
            <button class="nav-btn" onclick="showPanel('cross')">CROSS</button>
            <button class="nav-btn" onclick="showPanel('audio')">AUDIO</button>
            <button class="nav-btn" onclick="showPanel('video')">VIDEO</button>
        </nav>

        <main id="content">
            <!-- HOME PANEL (SMART DETECT) -->
            <div id="panel-home" class="panel">
                <div id="drop-zone" class="drop-zone" onclick="document.getElementById('smart-file-input').click()"
                    ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <!-- Hidden input for click-to-select -->
                    <input type="file" id="smart-file-input" style="display:none" onchange="handleSmartInput(this)">
                    <div class="drop-content">
                        <span style="font-size: 3rem;">ðŸ“¥</span>
                        <h3>DROP FILE OR CLICK TO ANALYZE</h3>
                        <p>AUTODETECTS FORMAT & SUGGESTS TOOLS</p>
                    </div>
                </div>

                <div id="smart-actions" style="display: none; margin-top: 20px;">
                    <h3>// RECOMMENDED ACTIONS <span id="smart-filename"
                            style="color: var(--accent-color); font-size: 0.8em;"></span></h3>
                    <div id="actions-grid" class="actions-grid">
                        <!-- JS injects buttons here -->
                    </div>
                </div>
            </div>

            <!-- ARCHIVE PANEL -->
            <div id="panel-archive" class="panel" style="display:none;">
                <h2>// ARCHIVE PROTOCOL</h2>
                <div class="tool-group">
                    <h3>CONVERT ARCHIVE</h3>
                    <form onsubmit="handleConvert(event, '/api/convert/archive')">
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-arch-conv" class="hidden-input"
                                accept=".zip,.tar,.gz,.7z,.rar" required onchange="updateLabel(this)">
                            <label for="file-arch-conv" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE A FILE</span>
                            </label>
                        </div>
                        <label>TARGET FORMAT:</label>
                        <select name="target_format">
                            <option value="zip">ZIP</option>
                            <option value="gztar">TAR.GZ</option>
                            <option value="tar">TAR</option>
                        </select>
                        <button type="submit">EXECUTE</button>
                    </form>
                </div>
            </div>

            <!-- DATA PANEL -->
            <div id="panel-data" class="panel" style="display:none;">
                <h2>// DATA PROCESSING</h2>

                <div class="tool-group">
                    <h3>CSV â†’ JSON</h3>
                    <form onsubmit="handleConvert(event, '/api/convert/csv-to-json')">
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-csv-json" class="hidden-input" accept=".csv"
                                required onchange="updateLabel(this)">
                            <label for="file-csv-json" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE CSV FILE</span>
                            </label>
                        </div>
                        <button type="submit">CONVERT TO JSON</button>
                    </form>
                </div>

                <div class="tool-group">
                    <h3>JSON â†’ CSV</h3>
                    <form onsubmit="handleConvert(event, '/api/convert/json-to-csv')">
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-json-csv" class="hidden-input" accept=".json"
                                required onchange="updateLabel(this)">
                            <label for="file-json-csv" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE JSON FILE</span>
                            </label>
                        </div>
                        <button type="submit">CONVERT TO CSV</button>
                    </form>
                </div>

                <div class="tool-group">
                    <h3>CSV â†’ EXCEL (XLSX)</h3>
                    <form onsubmit="handleConvert(event, '/api/convert/csv-to-excel')">
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-csv-excel" class="hidden-input" accept=".csv"
                                required onchange="updateLabel(this)">
                            <label for="file-csv-excel" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE CSV FILE</span>
                            </label>
                        </div>
                        <button type="submit">CONVERT TO EXCEL</button>
                    </form>
                </div>

                <div class="tool-group">
                    <h3>EXCEL (XLSX) â†’ CSV</h3>
                    <form onsubmit="handleConvert(event, '/api/convert/excel-to-csv')">
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-excel-csv" class="hidden-input" accept=".xlsx,.xls"
                                required onchange="updateLabel(this)">
                            <label for="file-excel-csv" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE EXCEL FILE</span>
                            </label>
                        </div>
                        <button type="submit">CONVERT TO CSV</button>
                    </form>
                </div>
            </div>

            <!-- DEV PANEL -->
            <div id="panel-dev" class="panel" style="display:none;">
                <h2>// DEVELOPER PROTOCOL</h2>

                <!-- CODE TRANSLATOR -->
                <div class="tool-group"
                    style="border-color: var(--highlight-color); box-shadow: 4px 4px 0px var(--highlight-color);">
                    <h3>AI CODE TRANSLATOR (EXPERIMENTAL)</h3>
                    <p style="font-size: 0.8rem; margin-bottom: 1rem;">REQUIRES API KEY FOR SMART TRANSLATION. LOCAL
                        MODE SUPPORTS BASIC SYNTAX ONLY.</p>
                    <form onsubmit="handleTranslate(event)">
                        <div style="grid-column: span 2; display: flex; gap: 1rem;">
                            <select id="trans-source" style="flex:1">
                                <option value="java">JAVA</option>
                                <option value="python">PYTHON</option>
                                <option value="javascript">JAVASCRIPT</option>
                                <option value="cpp">C++</option>
                            </select>
                            <span style="align-self: center;">&rarr;</span>
                            <select id="trans-target" style="flex:1">
                                <option value="python">PYTHON</option>
                                <option value="java">JAVA</option>
                                <option value="javascript">JAVASCRIPT</option>
                                <option value="cpp">C++</option>
                            </select>
                        </div>

                        <div style="grid-column: span 2;">
                            <label>API KEY (Optional - Leave empty for Regex):</label>
                            <input type="password" id="api-key" placeholder="Gemini / OpenAI Key (Currently Simulated)"
                                style="width: 100%;">
                        </div>

                        <div style="grid-column: span 2; display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <label>SOURCE CODE:</label>
                                <textarea id="code-input"
                                    style="width: 100%; height: 200px; background: var(--input-bg); color: var(--text-color); border: var(--border-width) solid var(--border-color); padding: 0.5rem; font-family: monospace; resize: vertical;"></textarea>
                            </div>
                            <div>
                                <label>OUTPUT:</label>
                                <textarea id="code-output" readonly
                                    style="width: 100%; height: 200px; background: #eee; color: #000; border: var(--border-width) solid var(--border-color); padding: 0.5rem; font-family: monospace; resize: vertical;"></textarea>
                            </div>
                        </div>

                        <button type="submit"
                            style="width: 100%; grid-column: span 2; background: var(--highlight-color); color: #fff;">TRANSLATE
                            CODE</button>
                    </form>
                </div>

                <div class="tool-group">
                    <h3>CONFIG CONVERTER</h3>
                    <form onsubmit="handleConvert(event, '/api/dev/convert-config')">
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-dev-conf" class="hidden-input"
                                accept=".json,.yaml,.yml,.xml" required onchange="updateLabel(this)">
                            <label for="file-dev-conf" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE Config File</span>
                            </label>
                        </div>
                        <label>TARGET FORMAT:</label>
                        <select name="target_format">
                            <option value="json">JSON</option>
                            <option value="yaml">YAML</option>
                            <option value="xml">XML</option>
                        </select>
                        <button type="submit">EXECUTE</button>
                    </form>
                </div>

                <div class="tool-group">
                    <h3>MARKDOWN TO PDF</h3>
                    <form onsubmit="handleConvert(event, '/api/dev/md-to-pdf')">
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-dev-md" class="hidden-input" accept=".md" required
                                onchange="updateLabel(this)">
                            <label for="file-dev-md" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE Markdown (.md)</span>
                            </label>
                        </div>
                        <button type="submit">CONVERT TO PDF</button>
                    </form>
                </div>

                <div class="tool-group">
                    <h3>BASE64 UTILS</h3>
                    <form onsubmit="handleConvert(event, '/api/dev/base64')">
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-dev-b64" class="hidden-input" required
                                onchange="updateLabel(this)">
                            <label for="file-dev-b64" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE A FILE</span>
                            </label>
                        </div>
                        <label>ACTION:</label>
                        <select name="action">
                            <option value="encode">ENCODE TO TEXT</option>
                            <option value="decode">DECODE TO FILE</option>
                        </select>
                        <button type="submit">EXECUTE</button>
                    </form>
                </div>
<!-- CODE FORMATTING TOOLS -->
<div class="tool-group" style="border-color: var(--highlight-color); box-shadow: 4px 4px 0px var(--highlight-color);">
    <h3>JAVASCRIPT FORMATTER</h3>
    <form onsubmit="handleCodeFormat(event, 'js')">
        <div class="file-upload-wrapper">
            <input type="file" name="file" id="file-js-format" class="hidden-input" accept=".js" required
                onchange="updateLabel(this)">
            <label for="file-js-format" class="custom-file-label">
                <span class="plus-symbol">+</span>
                <span class="file-name">CHOOSE JS FILE</span>
            </label>
        </div>
        <label>ACTION:</label>
        <select name="action" id="js-action">
            <option value="beautify">BEAUTIFY / PRETTIFY</option>
            <option value="minify">MINIFY</option>
        </select>
        <button type="submit">FORMAT</button>
    </form>
</div>

<div class="tool-group" style="border-color: var(--highlight-color); box-shadow: 4px 4px 0px var(--highlight-color);">
    <h3>CSS FORMATTER</h3>
    <form onsubmit="handleCodeFormat(event, 'css')">
        <div class="file-upload-wrapper">
            <input type="file" name="file" id="file-css-format" class="hidden-input" accept=".css" required
                onchange="updateLabel(this)">
            <label for="file-css-format" class="custom-file-label">
                <span class="plus-symbol">+</span>
                <span class="file-name">CHOOSE CSS FILE</span>
            </label>
        </div>
        <label>ACTION:</label>
        <select name="action" id="css-action">
            <option value="beautify">BEAUTIFY / PRETTIFY</option>
            <option value="minify">MINIFY</option>
        </select>
        <button type="submit">FORMAT</button>
    </form>
</div>

<div class="tool-group" style="border-color: var(--highlight-color); box-shadow: 4px 4px 0px var(--highlight-color);">
    <h3>HTML FORMATTER</h3>
    <form onsubmit="handleCodeFormat(event, 'html')">
        <div class="file-upload-wrapper">
            <input type="file" name="file" id="file-html-format" class="hidden-input" accept=".html,.htm" required
                onchange="updateLabel(this)">
            <label for="file-html-format" class="custom-file-label">
                <span class="plus-symbol">+</span>
                <span class="file-name">CHOOSE HTML FILE</span>
            </label>
        </div>
        <label>ACTION:</label>
        <select name="action" id="html-action">
            <option value="beautify">BEAUTIFY / PRETTIFY</option>
            <option value="minify">MINIFY</option>
            <option value="to-pdf">CONVERT TO PDF</option>
        </select>
        <button type="submit">FORMAT</button>
    </form>
</div>            </div>

            <!-- IMAGE PANEL -->
            <div id="panel-images" class="panel" style="display:none;">
                <h2>// IMAGE PROTOCOL</h2>
                <div class="tool-group">
                    <h3>CONVERT</h3>
                    <form onsubmit="handleConvert(event, '/api/convert/image')">
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-img-conv" class="hidden-input"
                                accept="image/*,.heic,.heif,.tiff,.svg" required onchange="updateLabel(this)">
                            <label for="file-img-conv" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE A FILE</span>
                            </label>
                        </div>

                        <label>TARGET FORMAT:</label>
                        <select name="target_format">
                            <option value="JPG">JPG</option>
                            <option value="PNG">PNG</option>
                            <option value="WEBP">WEBP</option>
                            <option value="TIFF">TIFF</option>
                            <option value="ICO">ICO</option>
                        </select>
                        <button type="submit">EXECUTE</button>
                    </form>
                </div>
                <div class="tool-group">
                    <h3>COMPRESS</h3>
                    <form onsubmit="handleConvert(event, '/api/compress/image')">
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-img-comp" class="hidden-input" accept="image/*"
                                required onchange="updateLabel(this)">
                            <label for="file-img-comp" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE A FILE</span>
                            </label>
                        </div>

                        <label>SIZE LIMIT (KB):</label>
                        <input type="number" name="size_kb" value="500">
                        <button type="submit">EXECUTE</button>
                    </form>
                </div>
                <div class="tool-group">
                    <h3>RESIZE IMAGE (SCALE)</h3>
                    <form onsubmit="handleConvert(event, '/api/resize/image')">
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-img-resize" class="hidden-input" accept="image/*"
                                required onchange="handleResizeInput(this)">
                            <label for="file-img-resize" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE A FILE</span>
                            </label>
                        </div>

                        <div style="margin-top: 10px;">
                            <label>SCALE: <span id="resize-val">100%</span></label>
                            <input type="range" name="percentage" id="resize-slider" min="1" max="100" value="100"
                                style="width: 100%;" oninput="updateResizeCalc()">
                        </div>

                        <div id="resize-feedback"
                            style="font-family: var(--font-heading); margin-top: 10px; font-size: 0.8rem; background: var(--text-color); color: var(--panel-bg); padding: 5px;">
                            ORIGINAL: - | NEW: -
                        </div>

                        <button type="submit" style="margin-top: 10px;">RESIZE</button>
                    </form>
                </div>
            </div>

            <!-- DOC PANEL -->
            <div id="panel-docs" class="panel" style="display:none;">
                <h2>// DOCUMENT PROTOCOL</h2>
                <div class="tool-group">
                    <h3>CONVERT DOCUMENT</h3>
                    <form onsubmit="handleConvert(event, '/api/convert/doc')">
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-doc-conv" class="hidden-input"
                                accept=".docx,.txt,.csv" required onchange="updateLabel(this)">
                            <label for="file-doc-conv" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE A FILE</span>
                            </label>
                        </div>

                        <label>TARGET FORMAT:</label>
                        <select name="target_format">
                            <option value="pdf">PDF</option>
                            <option value="docx">DOCX</option>
                            <option value="txt">TXT</option>
                        </select>
                        <button type="submit">EXECUTE</button>
                    </form>
                </div>
                <div class="tool-group">
                    <h3>PDF TO IMAGES</h3>
                    <form onsubmit="handleConvert(event, '/api/convert/pdf-to-image')">
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-pdf-img" class="hidden-input" accept=".pdf" required
                                onchange="updateLabel(this)">
                            <label for="file-pdf-img" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE A FILE</span>
                            </label>
                        </div>

                        <label>FORMAT:</label>
                        <select name="format">
                            <option value="png">PNG</option>
                            <option value="jpg">JPG</option>
                        </select>
                        <button type="submit">EXECUTE</button>
                    </form>
                </div>
                <div class="tool-group">
                    <h3>COMPRESS PDF (QUALITY)</h3>
                    <form onsubmit="handleConvert(event, '/api/compress/pdf')">
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-pdf-comp" class="hidden-input" accept=".pdf"
                                required onchange="updateLabel(this)">
                            <label for="file-pdf-comp" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE A FILE</span>
                            </label>
                        </div>

                        <div style="margin-top: 10px;">
                            <label>QUALITY: <span id="pdf-quality-val">MEDIUM</span></label>
                            <input type="range" id="pdf-slider" min="0" max="100" value="50" style="width: 100%;"
                                oninput="updatePdfQuality(this)">
                            <!-- Hidden input to send 'level' string to backend -->
                            <input type="hidden" name="level" id="pdf-level-input" value="medium">
                        </div>

                        <button type="submit">COMPRESS</button>
                    </form>
                </div>
            </div>

            <!-- AUDIO PANEL -->
            <div id="panel-audio" class="panel" style="display:none;">
                <h2>// AUDIO PROTOCOL</h2>
                <div class="tool-group">
                    <h3>CONVERT</h3>
                    <form onsubmit="handleConvert(event, '/api/convert/media')">
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-audio" class="hidden-input" accept="audio/*"
                                required onchange="updateLabel(this)">
                            <label for="file-audio" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE A FILE</span>
                            </label>
                        </div>

                        <label>TARGET FORMAT:</label>
                        <select name="target_format">
                            <option value="mp3">MP3</option>
                            <option value="wav">WAV</option>
                            <option value="ogg">OGG</option>
                            <option value="aac">AAC</option>
                            <option value="flac">FLAC</option>
                        </select>
                        <button type="submit">EXECUTE</button>
                    </form>
                </div>
            </div>

            <!-- VIDEO PANEL -->
            <div id="panel-video" class="panel" style="display:none;">
                <h2>// VIDEO PROTOCOL</h2>
                <div class="tool-group">
                    <h3>CONVERT</h3>
                    <form onsubmit="handleConvert(event, '/api/convert/media')">
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-video" class="hidden-input" accept="video/*"
                                required onchange="updateLabel(this)">
                            <label for="file-video" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE A FILE</span>
                            </label>
                        </div>

                        <label>TARGET FORMAT:</label>
                        <select name="target_format">
                            <option value="mp4">MP4 (H.264)</option>
                            <option value="mkv">MKV</option>
                            <option value="webm">WEBM</option>
                            <option value="avi">AVI</option>
                        </select>
                        <button type="submit">EXECUTE</button>
                    </form>
                </div>
            </div>

            <!-- CROSS PANEL -->
            <div id="panel-cross" class="panel" style="display:none;">
                <h2>// CROSS PROTOCOL</h2>
                <div class="tool-group">
                    <h3>IMG TO DOC/PDF</h3>
                    <form onsubmit="handleConvert(event, '/api/convert/image-to-pdf', true)">
                        <!-- Pass true to use dynamic URL based on select -->
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-cross-img" class="hidden-input" accept="image/*"
                                required onchange="handleResizeInputCross(this)">
                            <label for="file-cross-img" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE IMAGE</span>
                            </label>
                        </div>

                        <div style="margin-top: 10px;">
                            <label>SCALE: <span id="cross-resize-val">100%</span></label>
                            <input type="range" name="percentage" id="cross-resize-slider" min="1" max="100" value="100"
                                style="width: 100%;" oninput="updateResizeCalcCross()">
                        </div>

                        <div id="cross-resize-feedback"
                            style="font-family: var(--font-heading); margin-top: 10px; font-size: 0.8rem; background: var(--text-color); color: var(--panel-bg); padding: 5px;">
                            ORIGINAL: - | NEW: -
                        </div>

                        <label style="margin-top: 10px;">OUTPUT FORMAT:</label>
                        <select id="cross-target-format" onchange="updateCrossFormAction(this)">
                            <option value="/api/convert/image-to-pdf">PDF</option>
                            <option value="/api/convert/image-to-docx">DOCX</option>
                        </select>

                        <button type="submit" style="margin-top: 10px;">CONVERT</button>
                    </form>
                </div>

                <div class="tool-group">
                    <h3>DOC/PDF TO IMG</h3>
                    <form onsubmit="handleConvert(event, '/api/convert/docx-to-image')">
                        <!-- DOCX endpoint handles both if pdf sent to it? No, need check logic. Actually simple: DOCX endpoint handles DOCX->PDF->IMG. For PDF input, use existing PDF->IMG endpoint. -->
                        <!-- Let's simplify: Use one form with dynamic action based on file type or selection? 
                              Actually, purely for DOCX->IMG we use the new endpoint. 
                              For PDF->IMG we use existing. 
                              Let's make this tool specifically for DOCS (DOCX) since PDF->IMG is already in DOC tab? 
                              User asked for "convert image to pdf / docs and vice versa".
                              So "DOC/PDF -> IMG".
                              I'll make this form handle DOCX specifically for now or dynamic.
                              Let's stick to DOCX -> IMG here as PDF->IMG is in DOC tab. Or Duplicate functionality?
                              Let's support DOCX here.
                         -->
                        <div class="file-upload-wrapper">
                            <input type="file" name="file" id="file-cross-doc" class="hidden-input" accept=".docx"
                                required onchange="updateLabel(this)">
                            <label for="file-cross-doc" class="custom-file-label">
                                <span class="plus-symbol">+</span>
                                <span class="file-name">CHOOSE DOCX</span>
                            </label>
                        </div>
                        <label>FORMAT:</label>
                        <select name="format">
                            <option value="png">PNG</option>
                            <option value="jpg">JPG</option>
                        </select>
                        <button type="submit">CONVERT</button>
                    </form>
                </div>
            </div>

            <div id="output-log" class="log-panel">
                <h3>SYSTEM LOG</h3>
                <pre id="logs">WAITING FOR COMMAND...</pre>
            </div>

            <div class="status-bar">
                <div class="path-display" id="path-display">OUTPUT: ~/Downloads/FORMATR_Output</div>
                <button class="btn-small" onclick="openOutputFolder()">OPEN FOLDER</button>
            </div>
        </main>
    </div>

    <div id="toast-container"></div>
    <script src="app.js"></script>
</body>

</html>
